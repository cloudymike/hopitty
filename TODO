Brew notes 130901

Cooler USB and temper thermometer seems to overlap
When the temper thermometer was added the the USB hub, but the cooler USB not
then it registered as all devices OK

Temper and cooler USB is interacting. When Temper is plugged in, the HW check OK's both
the boiler thermometer and the cooler.When CoolerUSB is plugged in temper is NOT recognized
In addition, when either thermometer is plugged in but not X10, it passes for HW/boiler. 
I'd expect fail on missing X10.

Only X10 plugged in, it hangs, sometimes.


Where to start
===============

Add display for error condition, red instead of green?

Add check for getting close to 50lb (-5.2 - 1.5 lb) in recipe check

add test for errorTester, set error unset error



logger
------
Create a logfile for at least each stage as it is run with timestamp and
key data (as temps and volumes)
http://docs.python.org/2/howto/logging.html

mash and sparge breakout
--------------------------
In mashProfiles, separate out mashing and sparging. Create a generic program
with switch for mashing and sparging.

At the same time, break the mashProfile module as it is too long right now.
Can this be an object?

breakout of last wort out
--------------------------
Create a last wort out based MultiBatchRecycleMash and use this for all cycles.
See previous todo, as this may be part of the same project...

breakout sensors
----------------
Breakout the sensors in the same way as with switches. Already done for cooler and boiler.

parameterize volume check
-------------------------
parameterize checkVolBSMX. Consider reading a setup file, time for .ini?

bad device descriptions
-----------------------
/dev/ttyUSB0 in rununit. Well this works great if the x10 serial is the first
device plugged in. If not it will fail. Find the real X10 device either by
using real device descriptor (/dev/serial) or scan the ttyUSBn

Slow runoff at end of sparge => pump cavitating
-----------------------------------------------
As there is wort left after the end of the brew, 1 h after the sparging,
this is probably result of slow runoff, a variation of stuck sparge

At the end of the cycle pumping the wort out, do it in stages with 
1 min rest in between. maybe a pint at a time for the last 2-4 quarts.
There will be no impact on overall time as the boiler pot is heating up the wort
but will not be ready for boil yet.

Check that the scale is on
---------------------------

The USB scale return 0 if off, so no simple way to see it it is on or not.
Tried to find a value that is representative but could not find anything
The good news is that the value on USB port is always 10th of oz, no matter
what mode the scale is in.
Alternative is to check that scale is moving when pump is running. If not put
everything on hold and sound alarm. This requires to new features
   Hold or pause, stop everything but hold it steady
   Alarm, sound alarm if something is wrong. web pages, sounds? 

Refactor myX10 to be based on simswitchlist.


5/25/2013 or thereabout
Test HW, verify that all USB hardware sensors and controllers are connected 
and can be attached to by the software.

In mashProfiles, break out water heating and sparging, as this is the same for all
current mash profiles.

5/5/2013 15:21

UscCmd failing in 64 bit. Add this code in Program.cs:
try
{
  listDevices();
}
catch
{
  return;
}


There is no way to see what recipe is selected until you push the start
button

dataMemcache: create nosetests for all methods. write-read-compare. Validate type of data

Create a maintenance programs module that is similar to recipeliststatus, but
reading the json files instead.

Add test button to runcontrol page. This will do a quick run and reality check of the recipe.

titles on stages page are not ordered, create some basic order, alphabetic OK

====== Less immediate =====
stages should probably be a class
Remove unused code
    Commented out code
    import statements with yellow triangle

coverage
--------
  covertests
  Start with all files not listed, should they be removed?
  Create a nosetests only option of covertests
  Identify lines not covered, add nosetests or remove or mark as not testable
     hardware lines. try to minimize the amount




====== Post brew issues and observations =======

== 130806

(Fixed) X10 switches not working 

(Fixed) Mash circulation pump stuck 

(Fixed) Create a run script that sets all options correctly so I do not have to think.
I forgot the -e switch, it would probably have found the x10 problem.

(Fixed) Boil temperature is very dependent on how close the Temper is to the pot. Create a shim
to make sure it is tight against the pot. Without shim, about 188 with about 198.

== 6/9/13
Stalling on hardware at line of pump start. Check why. This is with hardware and 
sudo

Remove requirements for sudo

Be able to refresh recipe while running?

The hose to the boiler pot must be above rim of pot to avoid siphoning.

TemPER thermometer is at 206 when boiling. Change boil start to 200.

Anti cavitation start of pumps.
With scale, if no weight change within x seconds, stop and start again
Without scale. Just start and stop multiple time the first time. Can be done in recipe.

== 04/28/13
Added cold water to hot water tun after mashin. This dropped the temperature and added 30 min to the mash cycle.

Siphoning from the mashtun to the boiler during sparging. Ended up with 3.8 gallons preboil so probably 2 quarts too much.

Needed to put this beer on hold, at the boiling stage. The  boil had just started but brought down to 190F (3 on burner) The first hops where however already added.

First use of aluminum pot,  The burner was turning off at setting  5, indicating bad contact between pot and burner. Seems to work OK after I moved the pot. This lead to slow heating to boil.

The new pot does not have a lip so pouring out of the pot lead to spilling about a quart of wort. Changed to siphoning instead.



==04/20/2013

Get all USB commands to work without sudo

Better holder for hose into boiler pot. The hose must be above the surface so no
siphoning will be happening. 

Better error messages when a recipe file is not properly provided. Try, as example
   ./runscan.py ../recipe/x10test
 This should have been -f but still tries to read a file and then fail
Also try reading in file with runscan.py from user that does not have one (as root)

Brewstages, as page is larger than one screen, every refresh pops page to top.  Fix for now, 
slow the page refresh to something like 15s or 30s.

The wort pump was running dry. It was close, was at 5.4 gallon, it should have been 5.47.
For now raise the volume used for equipment in recipe. Add check for equipment volume and total
volume in and out in checkers. Move from parseBSMX

=== 04/10/2013 
stages page has a links for number, why?
DTHe blue on green does not work.

== after brew 130202
Post cleaning not working as it relies on scale.

== after brew 130126

Add key mashing data to mash status page from recipe
  Equipment temperature
  (mash schedule..)

===== Hardware Issues =====
X10 controller hangs at startup at times. Debug this. It seems like a reboot
fixes the problem.

Consider create a HW check mode, that will fail if not all hardware sensors and 
controllers are OK


==== Checks =====
  mutex (link to other controller that should NOT be activated at same time)
  max values (as pump volume)
  Timeouts?
  watch dogs? Water checks?

